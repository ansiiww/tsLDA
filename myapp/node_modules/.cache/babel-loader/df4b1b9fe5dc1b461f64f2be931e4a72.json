{"ast":null,"code":"var _jsxFileName = \"/Users/tatsukikuze12/Desktop/PastClasses/SummerResearch/jsLDAcopy/myapp/src/corpage.js\";\nimport * as d3 from 'd3';\nimport React, { Component } from 'react';\n/* This function will compute pairwise correlations between topics.\n * Unlike the correlated topic model (CTM) LDA doesn't have parameters\n * that represent topic correlations. But that doesn't mean that topics are\n * not correlated, it just means we have to estimate those values by\n * measuring which topics appear in documents together.\n */\n\nclass Correlation extends Component {\n  constructor(props) {\n    super(props);\n    this.vis = d3.select(\"#corr-page\").append(\"svg\").attr(\"width\", this.state.w).attr(\"height\", this.state.h);\n    this.state = {\n      w: 650,\n      h: 650,\n      correlationMinTokens: 2,\n      correlationMinProportion: 0.05\n    };\n  }\n\n  plotMatrix() {\n    var left = 50;\n    var right = 500;\n    var top = 50;\n    var bottom = 500;\n    var correlationMatrix = this.getTopicCorrelations();\n    var correlationGraph = this.getCorrelationGraph(correlationMatrix, -100.0);\n    var topicScale = d3.scalePoint().domain(d3.range(this.props.numTopics)).range([left, right]);\n    var radiusScale = d3.scaleSqrt().domain([0, 1.0]).range([0, 450 / (2 * this.props.numTopics)]);\n    var horizontalTopics = vis.selectAll(\"text.hor\").data(correlationGraph.nodes);\n    horizontalTopics.exit().remove();\n    horizontalTopics = horizontalTopics.enter().append(\"text\").attr(\"class\", \"hor\").merge(horizontalTopics);\n    horizontalTopics.attr(\"x\", right + 10).attr(\"y\", function (node) {\n      return topicScale(node.name);\n    }).text(function (node) {\n      return node.words;\n    });\n    var verticalTopics = vis.selectAll(\"text.ver\").data(correlationGraph.nodes);\n    verticalTopics.exit().remove();\n    verticalTopics = verticalTopics.enter().append(\"text\").attr(\"class\", \"ver\").merge(verticalTopics);\n    verticalTopics.attr(\"x\", function (node) {\n      return topicScale(node.name);\n    }).attr(\"y\", bottom + 10).attr(\"transform\", function (node) {\n      return \"rotate(90,\" + topicScale(node.name) + \",\" + (bottom + 10) + \")\";\n    }).text(function (node) {\n      return node.words;\n    });\n    var circles = vis.selectAll(\"circle\").data(correlationGraph.links);\n    circles.exit().remove();\n    circles = circles.enter().append(\"circle\").merge(circles);\n    circles.attr(\"cx\", function (link) {\n      return topicScale(link.source);\n    }).attr(\"cy\", function (link) {\n      return topicScale(link.target);\n    }).attr(\"r\", function (link) {\n      return radiusScale(Math.abs(link.value));\n    }).style(\"fill\", function (link) {\n      return link.value > 0.0 ? \"#88f\" : \"#f88\";\n    }).on(\"mouseover\", function (link) {\n      var tooltip = d3.select(\"#tooltip\");\n      tooltip.style(\"visibility\", \"visible\").style(\"top\", event.pageY - 10 + \"px\").style(\"left\", event.pageX + 20 + \"px\").text(correlationGraph.nodes[link.target].words + \" / \" + correlationGraph.nodes[link.source].words);\n    }).on(\"mouseout\", function () {\n      var tooltip = d3.select(\"#tooltip\");\n      tooltip.style(\"visibility\", \"hidden\");\n    });\n  }\n\n  getTopicCorrelations() {\n    // initialize the matrix\n    var correlationMatrix = new Array(this.props.numTopics);\n\n    for (var t1 = 0; t1 < this.props.numTopics; t1++) {\n      correlationMatrix[t1] = this.props.zeros(this.props.numTopics);\n    }\n\n    var topicProbabilities = this.props.zeros(this.props.numTopics); // iterate once to get mean log topic proportions\n\n    this.props.documents.forEach(function (d, i) {\n      // We want to find the subset of topics that occur with non-trivial concentration in this document.\n      // Only consider topics with at least the minimum number of tokens that are at least 5% of the doc.\n      var documentTopics = new Array();\n      var tokenCutoff = Math.max(this.correlationMinTokens, this.correlationMinProportion * d.tokens.length);\n\n      for (var topic = 0; topic < this.props.numTopics; topic++) {\n        if (d.topicCounts[topic] >= tokenCutoff) {\n          documentTopics.push(topic);\n          topicProbabilities[topic]++; // Count the number of docs with this topic\n        }\n      } // Look at all pairs of topics that occur in the document.\n\n\n      for (var i = 0; i < documentTopics.length - 1; i++) {\n        for (var j = i + 1; j < documentTopics.length; j++) {\n          correlationMatrix[documentTopics[i]][documentTopics[j]]++;\n          correlationMatrix[documentTopics[j]][documentTopics[i]]++;\n        }\n      }\n    });\n\n    for (var t1 = 0; t1 < this.props.numTopics - 1; t1++) {\n      for (var t2 = t1 + 1; t2 < this.props.numTopics; t2++) {\n        correlationMatrix[t1][t2] = Math.log(this.props.documents.length * correlationMatrix[t1][t2] / (topicProbabilities[t1] * topicProbabilities[t2]));\n        correlationMatrix[t2][t1] = Math.log(this.props.documents.length * correlationMatrix[t2][t1] / (topicProbabilities[t1] * topicProbabilities[t2]));\n      }\n    }\n\n    return correlationMatrix;\n  }\n\n  getCorrelationGraph(correlationMatrix, cutoff) {\n    var graph = {\n      \"nodes\": [],\n      \"links\": []\n    };\n\n    for (var topic = 0; topic < this.props.numTopics; topic++) {\n      graph.nodes.push({\n        \"name\": topic,\n        \"group\": 1,\n        \"words\": this.props.topNWords(this.props.topicWordCounts[topic], 3)\n      });\n    }\n\n    for (var t1 = 0; t1 < this.props.numTopics; t1++) {\n      for (var t2 = 0; t2 < this.props.numTopics; t2++) {\n        if (t1 !== t2 && correlationMatrix[t1][t2] > cutoff) {\n          graph.links.push({\n            \"source\": t1,\n            \"target\": t2,\n            \"value\": correlationMatrix[t1][t2]\n          });\n        }\n      }\n    }\n\n    return graph;\n  }\n\n  componentDidMount() {}\n\n  componentDidUpdate(prevProps) {\n    this.plotMatrix();\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      id: \"corr-page\",\n      className: \"page\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"help\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 9\n      }\n    }, \"Topics that occur together more than expected are blue, topics that occur together less than expected are red.\"));\n  }\n\n}\n\nexport default Correlation;","map":{"version":3,"sources":["/Users/tatsukikuze12/Desktop/PastClasses/SummerResearch/jsLDAcopy/myapp/src/corpage.js"],"names":["d3","React","Component","Correlation","constructor","props","vis","select","append","attr","state","w","h","correlationMinTokens","correlationMinProportion","plotMatrix","left","right","top","bottom","correlationMatrix","getTopicCorrelations","correlationGraph","getCorrelationGraph","topicScale","scalePoint","domain","range","numTopics","radiusScale","scaleSqrt","horizontalTopics","selectAll","data","nodes","exit","remove","enter","merge","node","name","text","words","verticalTopics","circles","links","link","source","target","Math","abs","value","style","on","tooltip","event","pageY","pageX","Array","t1","zeros","topicProbabilities","documents","forEach","d","i","documentTopics","tokenCutoff","max","tokens","length","topic","topicCounts","push","j","t2","log","cutoff","graph","topNWords","topicWordCounts","componentDidMount","componentDidUpdate","prevProps","render"],"mappings":"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","sourcesContent":["import * as d3 from 'd3';\nimport React, { Component } from 'react'; \n\n/* This function will compute pairwise correlations between topics.\n * Unlike the correlated topic model (CTM) LDA doesn't have parameters\n * that represent topic correlations. But that doesn't mean that topics are\n * not correlated, it just means we have to estimate those values by\n * measuring which topics appear in documents together.\n */\n\nclass Correlation extends Component {\n    constructor(props) {\n      super(props);\n      this.state = {\n        w: 650,\n        h: 650,\n        correlationMinTokens: 2,\n        correlationMinProportion: 0.05\n    };\n    }\n\n    vis = d3.select(\"#corr-page\")\n    .append(\"svg\")\n    .attr(\"width\", this.state.w)\n    .attr(\"height\", this.state.h);\n\n    plotMatrix() {\n        var left = 50;\n        var right = 500;\n        var top = 50;\n        var bottom = 500;\n      \n        var correlationMatrix = this.getTopicCorrelations();\n        var correlationGraph = this.getCorrelationGraph(correlationMatrix, -100.0);\n      \n        var topicScale = d3.scalePoint().domain(d3.range(this.props.numTopics)).range([left, right]);\n        var radiusScale = d3.scaleSqrt().domain([0, 1.0]).range([0, 450 / (2 * this.props.numTopics)]);\n      \n        var horizontalTopics = vis.selectAll(\"text.hor\").data(correlationGraph.nodes);\n        horizontalTopics.exit().remove();\n        horizontalTopics = horizontalTopics.enter().append(\"text\")\n          .attr(\"class\", \"hor\")\n        .merge(horizontalTopics);\n      \n        horizontalTopics\n          .attr(\"x\", right + 10)\n          .attr(\"y\", function(node) { return topicScale(node.name); })\n          .text(function(node) { return node.words; });\n      \n        var verticalTopics = vis.selectAll(\"text.ver\").data(correlationGraph.nodes);\n        verticalTopics.exit().remove();\n        verticalTopics = verticalTopics.enter().append(\"text\")\n          .attr(\"class\", \"ver\")\n        .merge(verticalTopics);\n      \n        verticalTopics\n          .attr(\"x\", function(node) { return topicScale(node.name); })\n          .attr(\"y\", bottom + 10)\n          .attr(\"transform\", function(node) { return \"rotate(90,\" + topicScale(node.name) + \",\" + (bottom + 10) + \")\"; })\n          .text(function(node) { return node.words; });\n      \n        var circles = vis.selectAll(\"circle\").data(correlationGraph.links);\n        circles.exit().remove();\n        circles = circles.enter().append(\"circle\").merge(circles);\n      \n        circles.attr(\"cx\", function(link) { return topicScale(link.source); })\n        .attr(\"cy\", function(link) { return topicScale(link.target); })\n        .attr(\"r\", function (link) { return radiusScale(Math.abs(link.value)); })\n        .style(\"fill\", function (link) { return link.value > 0.0 ? \"#88f\" : \"#f88\"; })\n        .on(\"mouseover\", function (link) {\n          var tooltip = d3.select(\"#tooltip\");\n          tooltip.style(\"visibility\", \"visible\")\n          .style(\"top\", (event.pageY-10)+\"px\").style(\"left\",(event.pageX+20)+\"px\")\n          .text(correlationGraph.nodes[link.target].words + \" / \" + correlationGraph.nodes[link.source].words);\n        })\n        .on(\"mouseout\", function () {\n          var tooltip = d3.select(\"#tooltip\");\n          tooltip.style(\"visibility\", \"hidden\");\n        });\n      }\n    \n    getTopicCorrelations() {\n        // initialize the matrix\n        var correlationMatrix = new Array(this.props.numTopics);\n        for (var t1 = 0; t1 < this.props.numTopics; t1++) {\n          correlationMatrix[t1] = this.props.zeros(this.props.numTopics);\n        }\n      \n        var topicProbabilities = this.props.zeros(this.props.numTopics);\n      \n        // iterate once to get mean log topic proportions\n        this.props.documents.forEach(function(d, i) {\n      \n          // We want to find the subset of topics that occur with non-trivial concentration in this document.\n          // Only consider topics with at least the minimum number of tokens that are at least 5% of the doc.\n          var documentTopics = new Array();\n          var tokenCutoff = Math.max(this.correlationMinTokens, this.correlationMinProportion * d.tokens.length);\n      \n          for (var topic = 0; topic < this.props.numTopics; topic++) {\n            if (d.topicCounts[topic] >= tokenCutoff) {\n              documentTopics.push(topic);\n              topicProbabilities[topic]++; // Count the number of docs with this topic\n            }\n          }\n      \n          // Look at all pairs of topics that occur in the document.\n          for (var i = 0; i < documentTopics.length - 1; i++) {\n            for (var j = i + 1; j < documentTopics.length; j++) {\n              correlationMatrix[ documentTopics[i] ][ documentTopics[j] ]++;\n              correlationMatrix[ documentTopics[j] ][ documentTopics[i] ]++;\n            }\n          }\n        });\n        for (var t1 = 0; t1 < this.props.numTopics - 1; t1++) {\n          for (var t2 = t1 + 1; t2 < this.props.numTopics; t2++) {\n            correlationMatrix[t1][t2] = Math.log((this.props.documents.length * correlationMatrix[t1][t2]) /\n                                                 (topicProbabilities[t1] * topicProbabilities[t2]));\n            correlationMatrix[t2][t1] = Math.log((this.props.documents.length * correlationMatrix[t2][t1]) /\n                                                 (topicProbabilities[t1] * topicProbabilities[t2]));\n          }\n        }\n      \n        return correlationMatrix;\n      }\n\n    getCorrelationGraph(correlationMatrix, cutoff) {\n        var graph = {\"nodes\": [], \"links\": []};\n        for (var topic = 0; topic < this.props.numTopics; topic++) {\n          graph.nodes.push({\"name\": topic, \"group\": 1, \"words\": this.props.topNWords(this.props.topicWordCounts[topic], 3)});\n        }\n        for (var t1 = 0; t1 < this.props.numTopics; t1++) {\n          for (var t2 = 0; t2 < this.props.numTopics; t2++) {\n            if (t1 !== t2 && correlationMatrix[t1][t2] > cutoff) {\n              graph.links.push({\"source\": t1, \"target\": t2, \"value\": correlationMatrix[t1][t2]});\n            }\n          }\n        }\n        return graph;\n      }\n\n    componentDidMount() {\n    }\n\n    componentDidUpdate(prevProps) {\n        this.plotMatrix();\n    }\n\n    render() {\n      return (\n      <div id=\"corr-page\" className=\"page\">\n        <div className=\"help\">Topics that occur together more than expected are blue, topics that occur together less than expected are red.</div>\n      </div>\n      )\n    }\n}\n\nexport default Correlation;"]},"metadata":{},"sourceType":"module"}