{"ast":null,"code":"import * as d3 from 'd3';\n/* This function will compute pairwise correlations between topics.\n * Unlike the correlated topic model (CTM) LDA doesn't have parameters\n * that represent topic correlations. But that doesn't mean that topics are\n * not correlated, it just means we have to estimate those values by\n * measuring which topics appear in documents together.\n */\n\nclass Correlation extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      w: 650,\n      h: 650,\n      correlationMinTokens: 2,\n      correlationMinProportion: 0.05\n    };\n  }\n\n  componentDidMount() {\n    this.findNumTopics(); // Set upon initialisation, changed to new numTopics in reset\n\n    d3.select(\"#num-topics-input\").attr(\"value\", this.state.numTopics);\n    this.setState({\n      tokensPerTopic: this.zeros(this.state.numTopics)\n    });\n    this.setState({\n      topicWeights: this.zeros(this.state.numTopics)\n    }); // used by parseLine\n\n    d3.select(\"#docs-tab\").on(\"click\", function () {\n      d3.selectAll(\".page\").style(\"display\", \"none\");\n      d3.selectAll(\"ul li\").attr(\"className\", \"\");\n      d3.select(\"#docs-page\").style(\"display\", \"block\");\n      d3.select(\"#docs-tab\").attr(\"className\", \"selected\");\n      this.queueLoad();\n    });\n  }\n\n}\n\nfunction getTopicCorrelations(props) {\n  // initialize the matrix\n  var correlationMatrix = new Array(props.numTopics);\n\n  for (var t1 = 0; t1 < props.numTopics; t1++) {\n    correlationMatrix[t1] = props.zeros(props.numTopics);\n  }\n\n  var topicProbabilities = props.zeros(props.numTopics); // iterate once to get mean log topic proportions\n\n  props.documents.forEach(function (d, i) {\n    // We want to find the subset of topics that occur with non-trivial concentration in this document.\n    // Only consider topics with at least the minimum number of tokens that are at least 5% of the doc.\n    var documentTopics = new Array();\n    var tokenCutoff = Math.max(props.correlationMinTokens, props.correlationMinProportion * d.tokens.length);\n\n    for (var topic = 0; topic < props.numTopics; topic++) {\n      if (d.topicCounts[topic] >= tokenCutoff) {\n        documentTopics.push(topic);\n        topicProbabilities[topic]++; // Count the number of docs with this topic\n      }\n    } // Look at all pairs of topics that occur in the document.\n\n\n    for (var i = 0; i < documentTopics.length - 1; i++) {\n      for (var j = i + 1; j < documentTopics.length; j++) {\n        correlationMatrix[documentTopics[i]][documentTopics[j]]++;\n        correlationMatrix[documentTopics[j]][documentTopics[i]]++;\n      }\n    }\n  });\n\n  for (var t1 = 0; t1 < props.numTopics - 1; t1++) {\n    for (var t2 = t1 + 1; t2 < props.numTopics; t2++) {\n      correlationMatrix[t1][t2] = Math.log(props.documents.length * correlationMatrix[t1][t2] / (topicProbabilities[t1] * topicProbabilities[t2]));\n      correlationMatrix[t2][t1] = Math.log(props.documents.length * correlationMatrix[t2][t1] / (topicProbabilities[t1] * topicProbabilities[t2]));\n    }\n  }\n\n  return correlationMatrix;\n}\n\nfunction getCorrelationGraph(props) {\n  // correlationMatrix, cutoff\n  var graph = {\n    \"nodes\": [],\n    \"links\": []\n  };\n\n  for (var topic = 0; topic < props.numTopics; topic++) {\n    graph.nodes.push({\n      \"name\": topic,\n      \"group\": 1,\n      \"words\": props.topNWords(props.topicWordCounts[topic], 3)\n    });\n  }\n\n  for (var t1 = 0; t1 < props.numTopics; t1++) {\n    for (var t2 = 0; t2 < props.numTopics; t2++) {\n      if (t1 !== t2 && props.correlationMatrix[t1][t2] > props.cutoff) {\n        graph.links.push({\n          \"source\": t1,\n          \"target\": t2,\n          \"value\": props.correlationMatrix[t1][t2]\n        });\n      }\n    }\n  }\n\n  return graph;\n}\n\nfunction plotMatrix(props) {\n  /* SVG functions */\n  var w = 650,\n      h = 650; // Used in plotMatrix\n\n  var vis = d3.select(\"#corr-page\").append(\"svg\").attr(\"width\", w).attr(\"height\", h); // Used by vis\n\n  d3.select(\"#corr-tab\").on(\"click\", function () {\n    d3.selectAll(\".page\").style(\"display\", \"none\");\n    d3.selectAll(\"ul li\").attr(\"class\", \"\");\n    d3.select(\"#corr-page\").style(\"display\", \"block\");\n    d3.select(\"#corr-tab\").attr(\"class\", \"selected\");\n  });\n  var left = 50;\n  var right = 500;\n  var top = 50;\n  var bottom = 500;\n  var correlationMatrix = getTopicCorrelations(props);\n  var correlationGraph = getCorrelationGraph({\n    topicWordCounts: props.topicWordCounts,\n    topNWords: props.topNWords,\n    correlationMatrix: correlationMatrix,\n    cutoff: -100.0\n  });\n  var topicScale = d3.scalePoint().domain(d3.range(props.numTopics)).range([left, right]);\n  var radiusScale = d3.scaleSqrt().domain([0, 1.0]).range([0, 450 / (2 * props.numTopics)]);\n  var horizontalTopics = vis.selectAll(\"text.hor\").data(correlationGraph.nodes);\n  horizontalTopics.exit().remove();\n  horizontalTopics = horizontalTopics.enter().append(\"text\").attr(\"class\", \"hor\").merge(horizontalTopics);\n  horizontalTopics.attr(\"x\", right + 10).attr(\"y\", function (node) {\n    return topicScale(node.name);\n  }).text(function (node) {\n    return node.words;\n  });\n  var verticalTopics = vis.selectAll(\"text.ver\").data(correlationGraph.nodes);\n  verticalTopics.exit().remove();\n  verticalTopics = verticalTopics.enter().append(\"text\").attr(\"class\", \"ver\").merge(verticalTopics);\n  verticalTopics.attr(\"x\", function (node) {\n    return topicScale(node.name);\n  }).attr(\"y\", bottom + 10).attr(\"transform\", function (node) {\n    return \"rotate(90,\" + topicScale(node.name) + \",\" + (bottom + 10) + \")\";\n  }).text(function (node) {\n    return node.words;\n  });\n  var circles = vis.selectAll(\"circle\").data(correlationGraph.links);\n  circles.exit().remove();\n  circles = circles.enter().append(\"circle\").merge(circles);\n  circles.attr(\"cx\", function (link) {\n    return topicScale(link.source);\n  }).attr(\"cy\", function (link) {\n    return topicScale(link.target);\n  }).attr(\"r\", function (link) {\n    return radiusScale(Math.abs(link.value));\n  }).style(\"fill\", function (link) {\n    return link.value > 0.0 ? \"#88f\" : \"#f88\";\n  }).on(\"mouseover\", function (link) {\n    var tooltip = d3.select(\"#tooltip\");\n    tooltip.style(\"visibility\", \"visible\").style(\"top\", event.pageY - 10 + \"px\").style(\"left\", event.pageX + 20 + \"px\").text(correlationGraph.nodes[link.target].words + \" / \" + correlationGraph.nodes[link.source].words);\n  }).on(\"mouseout\", function () {\n    var tooltip = d3.select(\"#tooltip\");\n    tooltip.style(\"visibility\", \"hidden\");\n  });\n}\n\nexport default plotMatrix;","map":{"version":3,"sources":["/Users/tatsukikuze12/Desktop/PastClasses/SummerResearch/jsLDAcopy/myapp/src/Correlation.js"],"names":["d3","Correlation","Component","state","w","h","correlationMinTokens","correlationMinProportion","componentDidMount","findNumTopics","select","attr","numTopics","setState","tokensPerTopic","zeros","topicWeights","on","selectAll","style","queueLoad","getTopicCorrelations","props","correlationMatrix","Array","t1","topicProbabilities","documents","forEach","d","i","documentTopics","tokenCutoff","Math","max","tokens","length","topic","topicCounts","push","j","t2","log","getCorrelationGraph","graph","nodes","topNWords","topicWordCounts","cutoff","links","plotMatrix","vis","append","left","right","top","bottom","correlationGraph","topicScale","scalePoint","domain","range","radiusScale","scaleSqrt","horizontalTopics","data","exit","remove","enter","merge","node","name","text","words","verticalTopics","circles","link","source","target","abs","value","tooltip","event","pageY","pageX"],"mappings":"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","sourcesContent":["import * as d3 from 'd3';\n\n/* This function will compute pairwise correlations between topics.\n * Unlike the correlated topic model (CTM) LDA doesn't have parameters\n * that represent topic correlations. But that doesn't mean that topics are\n * not correlated, it just means we have to estimate those values by\n * measuring which topics appear in documents together.\n */\n\nclass Correlation extends Component {\n    state = {\n        w: 650,\n        h: 650,\n        correlationMinTokens: 2,\n        correlationMinProportion: 0.05\n    };\n\n    componentDidMount() {\n        this.findNumTopics();\n        // Set upon initialisation, changed to new numTopics in reset\n        d3.select(\"#num-topics-input\").attr(\"value\", this.state.numTopics);\n        \n        this.setState({tokensPerTopic: this.zeros(this.state.numTopics)});\n        this.setState({topicWeights: this.zeros(this.state.numTopics)});\n        \n        // used by parseLine\n        d3.select(\"#docs-tab\").on(\"click\", function() {\n          d3.selectAll(\".page\").style(\"display\", \"none\");\n          d3.selectAll(\"ul li\").attr(\"className\", \"\");\n          d3.select(\"#docs-page\").style(\"display\", \"block\");\n          d3.select(\"#docs-tab\").attr(\"className\", \"selected\");\n    \n        this.queueLoad();\n        });\n      }\n}\n\n\nfunction getTopicCorrelations(props) {\n    // initialize the matrix\n    var correlationMatrix = new Array(props.numTopics);\n    for (var t1 = 0; t1 < props.numTopics; t1++) {\n      correlationMatrix[t1] = props.zeros(props.numTopics);\n    }\n  \n    var topicProbabilities = props.zeros(props.numTopics);\n  \n    // iterate once to get mean log topic proportions\n    props.documents.forEach(function(d, i) {\n  \n      // We want to find the subset of topics that occur with non-trivial concentration in this document.\n      // Only consider topics with at least the minimum number of tokens that are at least 5% of the doc.\n      var documentTopics = new Array();\n      var tokenCutoff = Math.max(props.correlationMinTokens, props.correlationMinProportion * d.tokens.length);\n  \n      for (var topic = 0; topic < props.numTopics; topic++) {\n        if (d.topicCounts[topic] >= tokenCutoff) {\n          documentTopics.push(topic);\n          topicProbabilities[topic]++; // Count the number of docs with this topic\n        }\n      }\n  \n      // Look at all pairs of topics that occur in the document.\n      for (var i = 0; i < documentTopics.length - 1; i++) {\n        for (var j = i + 1; j < documentTopics.length; j++) {\n          correlationMatrix[ documentTopics[i] ][ documentTopics[j] ]++;\n          correlationMatrix[ documentTopics[j] ][ documentTopics[i] ]++;\n        }\n      }\n    });\n    for (var t1 = 0; t1 < props.numTopics - 1; t1++) {\n      for (var t2 = t1 + 1; t2 < props.numTopics; t2++) {\n        correlationMatrix[t1][t2] = Math.log((props.documents.length * correlationMatrix[t1][t2]) /\n                                             (topicProbabilities[t1] * topicProbabilities[t2]));\n        correlationMatrix[t2][t1] = Math.log((props.documents.length * correlationMatrix[t2][t1]) /\n                                             (topicProbabilities[t1] * topicProbabilities[t2]));\n      }\n    }\n  \n    return correlationMatrix;\n  }\n\nfunction getCorrelationGraph(props) { // correlationMatrix, cutoff\n    var graph = {\"nodes\": [], \"links\": []};\n    for (var topic = 0; topic < props.numTopics; topic++) {\n      graph.nodes.push({\"name\": topic, \"group\": 1, \"words\": props.topNWords(props.topicWordCounts[topic], 3)});\n    }\n    for (var t1 = 0; t1 < props.numTopics; t1++) {\n      for (var t2 = 0; t2 < props.numTopics; t2++) {\n        if (t1 !== t2 && props.correlationMatrix[t1][t2] > props.cutoff) {\n          graph.links.push({\"source\": t1, \"target\": t2, \"value\": props.correlationMatrix[t1][t2]});\n        }\n      }\n    }\n    return graph;\n  }\n\nfunction plotMatrix(props) {\n    /* SVG functions */\n    var w = 650,\n    h = 650;\n    // Used in plotMatrix\n    var vis = d3.select(\"#corr-page\")\n    .append(\"svg\")\n    .attr(\"width\", w)\n    .attr(\"height\", h);\n\n    // Used by vis\n    d3.select(\"#corr-tab\").on(\"click\", function() {\n        d3.selectAll(\".page\").style(\"display\", \"none\");\n        d3.selectAll(\"ul li\").attr(\"class\", \"\");\n        d3.select(\"#corr-page\").style(\"display\", \"block\");\n        d3.select(\"#corr-tab\").attr(\"class\", \"selected\");\n    });\n\n    var left = 50;\n    var right = 500;\n    var top = 50;\n    var bottom = 500;\n  \n    var correlationMatrix = getTopicCorrelations(props);\n    var correlationGraph = getCorrelationGraph({topicWordCounts: props.topicWordCounts,\n                                                topNWords: props.topNWords,\n                                                correlationMatrix: correlationMatrix,\n                                                cutoff: -100.0});\n  \n    var topicScale = d3.scalePoint().domain(d3.range(props.numTopics)).range([left, right]);\n    var radiusScale = d3.scaleSqrt().domain([0, 1.0]).range([0, 450 / (2 * props.numTopics)]);\n  \n    var horizontalTopics = vis.selectAll(\"text.hor\").data(correlationGraph.nodes);\n    horizontalTopics.exit().remove();\n    horizontalTopics = horizontalTopics.enter().append(\"text\")\n      .attr(\"class\", \"hor\")\n    .merge(horizontalTopics);\n  \n    horizontalTopics\n      .attr(\"x\", right + 10)\n      .attr(\"y\", function(node) { return topicScale(node.name); })\n      .text(function(node) { return node.words; });\n  \n    var verticalTopics = vis.selectAll(\"text.ver\").data(correlationGraph.nodes);\n    verticalTopics.exit().remove();\n    verticalTopics = verticalTopics.enter().append(\"text\")\n      .attr(\"class\", \"ver\")\n    .merge(verticalTopics);\n  \n    verticalTopics\n      .attr(\"x\", function(node) { return topicScale(node.name); })\n      .attr(\"y\", bottom + 10)\n      .attr(\"transform\", function(node) { return \"rotate(90,\" + topicScale(node.name) + \",\" + (bottom + 10) + \")\"; })\n      .text(function(node) { return node.words; });\n  \n    var circles = vis.selectAll(\"circle\").data(correlationGraph.links);\n    circles.exit().remove();\n    circles = circles.enter().append(\"circle\").merge(circles);\n  \n    circles.attr(\"cx\", function(link) { return topicScale(link.source); })\n    .attr(\"cy\", function(link) { return topicScale(link.target); })\n    .attr(\"r\", function (link) { return radiusScale(Math.abs(link.value)); })\n    .style(\"fill\", function (link) { return link.value > 0.0 ? \"#88f\" : \"#f88\"; })\n    .on(\"mouseover\", function (link) {\n      var tooltip = d3.select(\"#tooltip\");\n      tooltip.style(\"visibility\", \"visible\")\n      .style(\"top\", (event.pageY-10)+\"px\").style(\"left\",(event.pageX+20)+\"px\")\n      .text(correlationGraph.nodes[link.target].words + \" / \" + correlationGraph.nodes[link.source].words);\n    })\n    .on(\"mouseout\", function () {\n      var tooltip = d3.select(\"#tooltip\");\n      tooltip.style(\"visibility\", \"hidden\");\n    });\n  }\n\nexport default plotMatrix\n"]},"metadata":{},"sourceType":"module"}