{"ast":null,"code":"/* This function will compute pairwise correlations between topics.\n * Unlike the correlated topic model (CTM) LDA doesn't have parameters\n * that represent topic correlations. But that doesn't mean that topics are\n * not correlated, it just means we have to estimate those values by\n * measuring which topics appear in documents together.\n */\nfunction getTopicCorrelations(props) {\n  // initialize the matrix\n  var correlationMatrix = new Array(props.numTopics);\n\n  for (var t1 = 0; t1 < props.numTopics; t1++) {\n    correlationMatrix[t1] = props.zeros(props.numTopics);\n  }\n\n  var topicProbabilities = props.zeros(props.numTopics); // iterate once to get mean log topic proportions\n\n  props.documents.forEach(function (d, i) {\n    // We want to find the subset of topics that occur with non-trivial concentration in this document.\n    // Only consider topics with at least the minimum number of tokens that are at least 5% of the doc.\n    var documentTopics = new Array();\n    var tokenCutoff = Math.max(props.correlationMinTokens, props.correlationMinProportion * d.tokens.length);\n\n    for (var topic = 0; topic < props.numTopics; topic++) {\n      if (d.topicCounts[topic] >= tokenCutoff) {\n        documentTopics.push(topic);\n        topicProbabilities[topic]++; // Count the number of docs with this topic\n      }\n    } // Look at all pairs of topics that occur in the document.\n\n\n    for (var i = 0; i < documentTopics.length - 1; i++) {\n      for (var j = i + 1; j < documentTopics.length; j++) {\n        correlationMatrix[documentTopics[i]][documentTopics[j]]++;\n        correlationMatrix[documentTopics[j]][documentTopics[i]]++;\n      }\n    }\n  });\n\n  for (var t1 = 0; t1 < numTopics - 1; t1++) {\n    for (var t2 = t1 + 1; t2 < numTopics; t2++) {\n      correlationMatrix[t1][t2] = Math.log(documents.length * correlationMatrix[t1][t2] / (topicProbabilities[t1] * topicProbabilities[t2]));\n      correlationMatrix[t2][t1] = Math.log(documents.length * correlationMatrix[t2][t1] / (topicProbabilities[t1] * topicProbabilities[t2]));\n    }\n  }\n\n  return correlationMatrix;\n}\n\nfunction getCorrelationGraph(props) {\n  // correlationMatrix, cutoff\n  var graph = {\n    \"nodes\": [],\n    \"links\": []\n  };\n\n  for (var topic = 0; topic < numTopics; topic++) {\n    graph.nodes.push({\n      \"name\": topic,\n      \"group\": 1,\n      \"words\": topNWords(topicWordCounts[topic], 3)\n    });\n  }\n\n  for (var t1 = 0; t1 < numTopics; t1++) {\n    for (var t2 = 0; t2 < numTopics; t2++) {\n      if (t1 !== t2 && correlationMatrix[t1][t2] > cutoff) {\n        graph.links.push({\n          \"source\": t1,\n          \"target\": t2,\n          \"value\": correlationMatrix[t1][t2]\n        });\n      }\n    }\n  }\n\n  return graph;\n}\n\nfunction plotMatrix(props) {\n  /* SVG functions */\n  var w = 650,\n      h = 650; // Used in plotMatrix\n\n  var vis = d3.select(\"#corr-page\").append(\"svg\").attr(\"width\", w).attr(\"height\", h); // Used by vis\n\n  d3.select(\"#corr-tab\").on(\"click\", function () {\n    d3.selectAll(\".page\").style(\"display\", \"none\");\n    d3.selectAll(\"ul li\").attr(\"class\", \"\");\n    d3.select(\"#corr-page\").style(\"display\", \"block\");\n    d3.select(\"#corr-tab\").attr(\"class\", \"selected\");\n  });\n  var left = 50;\n  var right = 500;\n  var top = 50;\n  var bottom = 500;\n  var correlationMatrix = getTopicCorrelations(props);\n  var correlationGraph = getCorrelationGraph({\n    topicWordCounts: props.topicWordCounts,\n    topNWords: props.topNWords,\n    correlationMatrix: this.correlationMatrix,\n    cutoff: -100.0\n  });\n  var topicScale = d3.scalePoint().domain(d3.range(props.numTopics)).range([left, right]);\n  var radiusScale = d3.scaleSqrt().domain([0, 1.0]).range([0, 450 / (2 * props.numTopics)]);\n  var horizontalTopics = vis.selectAll(\"text.hor\").data(correlationGraph.nodes);\n  horizontalTopics.exit().remove();\n  horizontalTopics = horizontalTopics.enter().append(\"text\").attr(\"class\", \"hor\").merge(horizontalTopics);\n  horizontalTopics.attr(\"x\", right + 10).attr(\"y\", function (node) {\n    return topicScale(node.name);\n  }).text(function (node) {\n    return node.words;\n  });\n  var verticalTopics = vis.selectAll(\"text.ver\").data(correlationGraph.nodes);\n  verticalTopics.exit().remove();\n  verticalTopics = verticalTopics.enter().append(\"text\").attr(\"class\", \"ver\").merge(verticalTopics);\n  verticalTopics.attr(\"x\", function (node) {\n    return topicScale(node.name);\n  }).attr(\"y\", bottom + 10).attr(\"transform\", function (node) {\n    return \"rotate(90,\" + topicScale(node.name) + \",\" + (bottom + 10) + \")\";\n  }).text(function (node) {\n    return node.words;\n  });\n  var circles = vis.selectAll(\"circle\").data(correlationGraph.links);\n  circles.exit().remove();\n  circles = circles.enter().append(\"circle\").merge(circles);\n  circles.attr(\"cx\", function (link) {\n    return topicScale(link.source);\n  }).attr(\"cy\", function (link) {\n    return topicScale(link.target);\n  }).attr(\"r\", function (link) {\n    return radiusScale(Math.abs(link.value));\n  }).style(\"fill\", function (link) {\n    return link.value > 0.0 ? \"#88f\" : \"#f88\";\n  }).on(\"mouseover\", function (link) {\n    var tooltip = d3.select(\"#tooltip\");\n    tooltip.style(\"visibility\", \"visible\").style(\"top\", event.pageY - 10 + \"px\").style(\"left\", event.pageX + 20 + \"px\").text(correlationGraph.nodes[link.target].words + \" / \" + correlationGraph.nodes[link.source].words);\n  }).on(\"mouseout\", function () {\n    var tooltip = d3.select(\"#tooltip\");\n    tooltip.style(\"visibility\", \"hidden\");\n  });\n}","map":{"version":3,"sources":["/Users/tatsukikuze12/Desktop/PastClasses/SummerResearch/jsLDAcopy/myapp/src/Correlation.js"],"names":["getTopicCorrelations","props","correlationMatrix","Array","numTopics","t1","zeros","topicProbabilities","documents","forEach","d","i","documentTopics","tokenCutoff","Math","max","correlationMinTokens","correlationMinProportion","tokens","length","topic","topicCounts","push","j","t2","log","getCorrelationGraph","graph","nodes","topNWords","topicWordCounts","cutoff","links","plotMatrix","w","h","vis","d3","select","append","attr","on","selectAll","style","left","right","top","bottom","correlationGraph","topicScale","scalePoint","domain","range","radiusScale","scaleSqrt","horizontalTopics","data","exit","remove","enter","merge","node","name","text","words","verticalTopics","circles","link","source","target","abs","value","tooltip","event","pageY","pageX"],"mappings":"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","sourcesContent":["/* This function will compute pairwise correlations between topics.\n * Unlike the correlated topic model (CTM) LDA doesn't have parameters\n * that represent topic correlations. But that doesn't mean that topics are\n * not correlated, it just means we have to estimate those values by\n * measuring which topics appear in documents together.\n */\n\nfunction getTopicCorrelations(props) {\n    // initialize the matrix\n    var correlationMatrix = new Array(props.numTopics);\n    for (var t1 = 0; t1 < props.numTopics; t1++) {\n      correlationMatrix[t1] = props.zeros(props.numTopics);\n    }\n  \n    var topicProbabilities = props.zeros(props.numTopics);\n  \n    // iterate once to get mean log topic proportions\n    props.documents.forEach(function(d, i) {\n  \n      // We want to find the subset of topics that occur with non-trivial concentration in this document.\n      // Only consider topics with at least the minimum number of tokens that are at least 5% of the doc.\n      var documentTopics = new Array();\n      var tokenCutoff = Math.max(props.correlationMinTokens, props.correlationMinProportion * d.tokens.length);\n  \n      for (var topic = 0; topic < props.numTopics; topic++) {\n        if (d.topicCounts[topic] >= tokenCutoff) {\n          documentTopics.push(topic);\n          topicProbabilities[topic]++; // Count the number of docs with this topic\n        }\n      }\n  \n      // Look at all pairs of topics that occur in the document.\n      for (var i = 0; i < documentTopics.length - 1; i++) {\n        for (var j = i + 1; j < documentTopics.length; j++) {\n          correlationMatrix[ documentTopics[i] ][ documentTopics[j] ]++;\n          correlationMatrix[ documentTopics[j] ][ documentTopics[i] ]++;\n        }\n      }\n    });\n    for (var t1 = 0; t1 < numTopics - 1; t1++) {\n      for (var t2 = t1 + 1; t2 < numTopics; t2++) {\n        correlationMatrix[t1][t2] = Math.log((documents.length * correlationMatrix[t1][t2]) /\n                                             (topicProbabilities[t1] * topicProbabilities[t2]));\n        correlationMatrix[t2][t1] = Math.log((documents.length * correlationMatrix[t2][t1]) /\n                                             (topicProbabilities[t1] * topicProbabilities[t2]));\n      }\n    }\n  \n    return correlationMatrix;\n  }\n\nfunction getCorrelationGraph(props) { // correlationMatrix, cutoff\n    var graph = {\"nodes\": [], \"links\": []};\n    for (var topic = 0; topic < numTopics; topic++) {\n      graph.nodes.push({\"name\": topic, \"group\": 1, \"words\": topNWords(topicWordCounts[topic], 3)});\n    }\n    for (var t1 = 0; t1 < numTopics; t1++) {\n      for (var t2 = 0; t2 < numTopics; t2++) {\n        if (t1 !== t2 && correlationMatrix[t1][t2] > cutoff) {\n          graph.links.push({\"source\": t1, \"target\": t2, \"value\": correlationMatrix[t1][t2]});\n        }\n      }\n    }\n    return graph;\n  }\n\nfunction plotMatrix(props) {\n    /* SVG functions */\n    var w = 650,\n    h = 650;\n    // Used in plotMatrix\n    var vis = d3.select(\"#corr-page\")\n    .append(\"svg\")\n    .attr(\"width\", w)\n    .attr(\"height\", h);\n\n    // Used by vis\n    d3.select(\"#corr-tab\").on(\"click\", function() {\n        d3.selectAll(\".page\").style(\"display\", \"none\");\n        d3.selectAll(\"ul li\").attr(\"class\", \"\");\n        d3.select(\"#corr-page\").style(\"display\", \"block\");\n        d3.select(\"#corr-tab\").attr(\"class\", \"selected\");\n    });\n\n    var left = 50;\n    var right = 500;\n    var top = 50;\n    var bottom = 500;\n  \n    var correlationMatrix = getTopicCorrelations(props);\n    var correlationGraph = getCorrelationGraph({topicWordCounts: props.topicWordCounts,\n                                                topNWords: props.topNWords,\n                                                correlationMatrix: this.correlationMatrix,\n                                                cutoff: -100.0});\n  \n    var topicScale = d3.scalePoint().domain(d3.range(props.numTopics)).range([left, right]);\n    var radiusScale = d3.scaleSqrt().domain([0, 1.0]).range([0, 450 / (2 * props.numTopics)]);\n  \n    var horizontalTopics = vis.selectAll(\"text.hor\").data(correlationGraph.nodes);\n    horizontalTopics.exit().remove();\n    horizontalTopics = horizontalTopics.enter().append(\"text\")\n      .attr(\"class\", \"hor\")\n    .merge(horizontalTopics);\n  \n    horizontalTopics\n      .attr(\"x\", right + 10)\n      .attr(\"y\", function(node) { return topicScale(node.name); })\n      .text(function(node) { return node.words; });\n  \n    var verticalTopics = vis.selectAll(\"text.ver\").data(correlationGraph.nodes);\n    verticalTopics.exit().remove();\n    verticalTopics = verticalTopics.enter().append(\"text\")\n      .attr(\"class\", \"ver\")\n    .merge(verticalTopics);\n  \n    verticalTopics\n      .attr(\"x\", function(node) { return topicScale(node.name); })\n      .attr(\"y\", bottom + 10)\n      .attr(\"transform\", function(node) { return \"rotate(90,\" + topicScale(node.name) + \",\" + (bottom + 10) + \")\"; })\n      .text(function(node) { return node.words; });\n  \n    var circles = vis.selectAll(\"circle\").data(correlationGraph.links);\n    circles.exit().remove();\n    circles = circles.enter().append(\"circle\").merge(circles);\n  \n    circles.attr(\"cx\", function(link) { return topicScale(link.source); })\n    .attr(\"cy\", function(link) { return topicScale(link.target); })\n    .attr(\"r\", function (link) { return radiusScale(Math.abs(link.value)); })\n    .style(\"fill\", function (link) { return link.value > 0.0 ? \"#88f\" : \"#f88\"; })\n    .on(\"mouseover\", function (link) {\n      var tooltip = d3.select(\"#tooltip\");\n      tooltip.style(\"visibility\", \"visible\")\n      .style(\"top\", (event.pageY-10)+\"px\").style(\"left\",(event.pageX+20)+\"px\")\n      .text(correlationGraph.nodes[link.target].words + \" / \" + correlationGraph.nodes[link.source].words);\n    })\n    .on(\"mouseout\", function () {\n      var tooltip = d3.select(\"#tooltip\");\n      tooltip.style(\"visibility\", \"hidden\");\n    });\n  }\n"]},"metadata":{},"sourceType":"module"}