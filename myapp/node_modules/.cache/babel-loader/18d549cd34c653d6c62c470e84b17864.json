{"ast":null,"code":"var _jsxFileName = \"/Users/tatsukikuze12/Desktop/PastClasses/SummerResearch/jsLDAcopy/myapp/src/corpage.js\";\nimport * as d3 from 'd3';\nimport React, { Component } from 'react';\n/* This function will compute pairwise correlations between topics.\n * Unlike the correlated topic model (CTM) LDA doesn't have parameters\n * that represent topic correlations. But that doesn't mean that topics are\n * not correlated, it just means we have to estimate those values by\n * measuring which topics appear in documents together.\n */\n\nclass Correlation extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      w: 650,\n      h: 650,\n      correlationMinTokens: 2,\n      correlationMinProportion: 0.05\n    };\n  }\n\n  plotMatrix() {\n    var left = 50;\n    var right = 500;\n    var top = 50;\n    var bottom = 500;\n    var correlationMatrix = this.getTopicCorrelations(props);\n    var correlationGraph = this.getCorrelationGraph(correlationMatrix, -100.0);\n    var topicScale = d3.scalePoint().domain(d3.range(props.numTopics)).range([left, right]);\n    var radiusScale = d3.scaleSqrt().domain([0, 1.0]).range([0, 450 / (2 * props.numTopics)]);\n    var horizontalTopics = vis.selectAll(\"text.hor\").data(correlationGraph.nodes);\n    horizontalTopics.exit().remove();\n    horizontalTopics = horizontalTopics.enter().append(\"text\").attr(\"class\", \"hor\").merge(horizontalTopics);\n    horizontalTopics.attr(\"x\", right + 10).attr(\"y\", function (node) {\n      return topicScale(node.name);\n    }).text(function (node) {\n      return node.words;\n    });\n    var verticalTopics = vis.selectAll(\"text.ver\").data(correlationGraph.nodes);\n    verticalTopics.exit().remove();\n    verticalTopics = verticalTopics.enter().append(\"text\").attr(\"class\", \"ver\").merge(verticalTopics);\n    verticalTopics.attr(\"x\", function (node) {\n      return topicScale(node.name);\n    }).attr(\"y\", bottom + 10).attr(\"transform\", function (node) {\n      return \"rotate(90,\" + topicScale(node.name) + \",\" + (bottom + 10) + \")\";\n    }).text(function (node) {\n      return node.words;\n    });\n    var circles = vis.selectAll(\"circle\").data(correlationGraph.links);\n    circles.exit().remove();\n    circles = circles.enter().append(\"circle\").merge(circles);\n    circles.attr(\"cx\", function (link) {\n      return topicScale(link.source);\n    }).attr(\"cy\", function (link) {\n      return topicScale(link.target);\n    }).attr(\"r\", function (link) {\n      return radiusScale(Math.abs(link.value));\n    }).style(\"fill\", function (link) {\n      return link.value > 0.0 ? \"#88f\" : \"#f88\";\n    }).on(\"mouseover\", function (link) {\n      var tooltip = d3.select(\"#tooltip\");\n      tooltip.style(\"visibility\", \"visible\").style(\"top\", event.pageY - 10 + \"px\").style(\"left\", event.pageX + 20 + \"px\").text(correlationGraph.nodes[link.target].words + \" / \" + correlationGraph.nodes[link.source].words);\n    }).on(\"mouseout\", function () {\n      var tooltip = d3.select(\"#tooltip\");\n      tooltip.style(\"visibility\", \"hidden\");\n    });\n  }\n\n  getTopicCorrelations() {\n    // initialize the matrix\n    var correlationMatrix = new Array(props.numTopics);\n\n    for (var t1 = 0; t1 < props.numTopics; t1++) {\n      correlationMatrix[t1] = props.zeros(props.numTopics);\n    }\n\n    var topicProbabilities = props.zeros(props.numTopics); // iterate once to get mean log topic proportions\n\n    props.documents.forEach(function (d, i) {\n      // We want to find the subset of topics that occur with non-trivial concentration in this document.\n      // Only consider topics with at least the minimum number of tokens that are at least 5% of the doc.\n      var documentTopics = new Array();\n      var tokenCutoff = Math.max(this.correlationMinTokens, this.correlationMinProportion * d.tokens.length);\n\n      for (var topic = 0; topic < props.numTopics; topic++) {\n        if (d.topicCounts[topic] >= tokenCutoff) {\n          documentTopics.push(topic);\n          topicProbabilities[topic]++; // Count the number of docs with this topic\n        }\n      } // Look at all pairs of topics that occur in the document.\n\n\n      for (var i = 0; i < documentTopics.length - 1; i++) {\n        for (var j = i + 1; j < documentTopics.length; j++) {\n          correlationMatrix[documentTopics[i]][documentTopics[j]]++;\n          correlationMatrix[documentTopics[j]][documentTopics[i]]++;\n        }\n      }\n    });\n\n    for (var t1 = 0; t1 < props.numTopics - 1; t1++) {\n      for (var t2 = t1 + 1; t2 < props.numTopics; t2++) {\n        correlationMatrix[t1][t2] = Math.log(props.documents.length * correlationMatrix[t1][t2] / (topicProbabilities[t1] * topicProbabilities[t2]));\n        correlationMatrix[t2][t1] = Math.log(props.documents.length * correlationMatrix[t2][t1] / (topicProbabilities[t1] * topicProbabilities[t2]));\n      }\n    }\n\n    return correlationMatrix;\n  }\n\n  getCorrelationGraph(correlationMatrix, cutoff) {\n    var graph = {\n      \"nodes\": [],\n      \"links\": []\n    };\n\n    for (var topic = 0; topic < props.numTopics; topic++) {\n      graph.nodes.push({\n        \"name\": topic,\n        \"group\": 1,\n        \"words\": props.topNWords(props.topicWordCounts[topic], 3)\n      });\n    }\n\n    for (var t1 = 0; t1 < props.numTopics; t1++) {\n      for (var t2 = 0; t2 < props.numTopics; t2++) {\n        if (t1 !== t2 && correlationMatrix[t1][t2] > cutoff) {\n          graph.links.push({\n            \"source\": t1,\n            \"target\": t2,\n            \"value\": correlationMatrix[t1][t2]\n          });\n        }\n      }\n    }\n\n    return graph;\n  }\n\n  componentDidMount() {\n    // Used in plotMatrix\n    var vis = d3.select(\"#corr-page\").append(\"svg\").attr(\"width\", w).attr(\"height\", h); // Used by vis\n\n    d3.select(\"#corr-tab\").on(\"click\", function () {\n      d3.selectAll(\".page\").style(\"display\", \"none\");\n      d3.selectAll(\"ul li\").attr(\"class\", \"\");\n      d3.select(\"#corr-page\").style(\"display\", \"block\");\n      d3.select(\"#corr-tab\").attr(\"class\", \"selected\");\n    });\n  }\n\n  static getDerivedStateFromProps(props, state) {}\n\n  render() {\n    /*#__PURE__*/\n    React.createElement(\"div\", {\n      id: \"corr-page\",\n      className: \"page\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"help\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 9\n      }\n    }, \"Topics that occur together more than expected are blue, topics that occur together less than expected are red.\"));\n  }\n\n}\n\nexport default Correlation;","map":{"version":3,"sources":["/Users/tatsukikuze12/Desktop/PastClasses/SummerResearch/jsLDAcopy/myapp/src/corpage.js"],"names":["d3","React","Component","Correlation","constructor","props","state","w","h","correlationMinTokens","correlationMinProportion","plotMatrix","left","right","top","bottom","correlationMatrix","getTopicCorrelations","correlationGraph","getCorrelationGraph","topicScale","scalePoint","domain","range","numTopics","radiusScale","scaleSqrt","horizontalTopics","vis","selectAll","data","nodes","exit","remove","enter","append","attr","merge","node","name","text","words","verticalTopics","circles","links","link","source","target","Math","abs","value","style","on","tooltip","select","event","pageY","pageX","Array","t1","zeros","topicProbabilities","documents","forEach","d","i","documentTopics","tokenCutoff","max","tokens","length","topic","topicCounts","push","j","t2","log","cutoff","graph","topNWords","topicWordCounts","componentDidMount","getDerivedStateFromProps","render"],"mappings":"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","sourcesContent":["import * as d3 from 'd3';\nimport React, { Component } from 'react'; \n\n/* This function will compute pairwise correlations between topics.\n * Unlike the correlated topic model (CTM) LDA doesn't have parameters\n * that represent topic correlations. But that doesn't mean that topics are\n * not correlated, it just means we have to estimate those values by\n * measuring which topics appear in documents together.\n */\n\nclass Correlation extends Component {\n    constructor(props) {\n      super(props);\n    }\n    state = {\n        w: 650,\n        h: 650,\n        correlationMinTokens: 2,\n        correlationMinProportion: 0.05\n    };\n\n\n    plotMatrix() {\n        var left = 50;\n        var right = 500;\n        var top = 50;\n        var bottom = 500;\n      \n        var correlationMatrix = this.getTopicCorrelations(props);\n        var correlationGraph = this.getCorrelationGraph(correlationMatrix, -100.0);\n      \n        var topicScale = d3.scalePoint().domain(d3.range(props.numTopics)).range([left, right]);\n        var radiusScale = d3.scaleSqrt().domain([0, 1.0]).range([0, 450 / (2 * props.numTopics)]);\n      \n        var horizontalTopics = vis.selectAll(\"text.hor\").data(correlationGraph.nodes);\n        horizontalTopics.exit().remove();\n        horizontalTopics = horizontalTopics.enter().append(\"text\")\n          .attr(\"class\", \"hor\")\n        .merge(horizontalTopics);\n      \n        horizontalTopics\n          .attr(\"x\", right + 10)\n          .attr(\"y\", function(node) { return topicScale(node.name); })\n          .text(function(node) { return node.words; });\n      \n        var verticalTopics = vis.selectAll(\"text.ver\").data(correlationGraph.nodes);\n        verticalTopics.exit().remove();\n        verticalTopics = verticalTopics.enter().append(\"text\")\n          .attr(\"class\", \"ver\")\n        .merge(verticalTopics);\n      \n        verticalTopics\n          .attr(\"x\", function(node) { return topicScale(node.name); })\n          .attr(\"y\", bottom + 10)\n          .attr(\"transform\", function(node) { return \"rotate(90,\" + topicScale(node.name) + \",\" + (bottom + 10) + \")\"; })\n          .text(function(node) { return node.words; });\n      \n        var circles = vis.selectAll(\"circle\").data(correlationGraph.links);\n        circles.exit().remove();\n        circles = circles.enter().append(\"circle\").merge(circles);\n      \n        circles.attr(\"cx\", function(link) { return topicScale(link.source); })\n        .attr(\"cy\", function(link) { return topicScale(link.target); })\n        .attr(\"r\", function (link) { return radiusScale(Math.abs(link.value)); })\n        .style(\"fill\", function (link) { return link.value > 0.0 ? \"#88f\" : \"#f88\"; })\n        .on(\"mouseover\", function (link) {\n          var tooltip = d3.select(\"#tooltip\");\n          tooltip.style(\"visibility\", \"visible\")\n          .style(\"top\", (event.pageY-10)+\"px\").style(\"left\",(event.pageX+20)+\"px\")\n          .text(correlationGraph.nodes[link.target].words + \" / \" + correlationGraph.nodes[link.source].words);\n        })\n        .on(\"mouseout\", function () {\n          var tooltip = d3.select(\"#tooltip\");\n          tooltip.style(\"visibility\", \"hidden\");\n        });\n      }\n    \n    getTopicCorrelations() {\n        // initialize the matrix\n        var correlationMatrix = new Array(props.numTopics);\n        for (var t1 = 0; t1 < props.numTopics; t1++) {\n          correlationMatrix[t1] = props.zeros(props.numTopics);\n        }\n      \n        var topicProbabilities = props.zeros(props.numTopics);\n      \n        // iterate once to get mean log topic proportions\n        props.documents.forEach(function(d, i) {\n      \n          // We want to find the subset of topics that occur with non-trivial concentration in this document.\n          // Only consider topics with at least the minimum number of tokens that are at least 5% of the doc.\n          var documentTopics = new Array();\n          var tokenCutoff = Math.max(this.correlationMinTokens, this.correlationMinProportion * d.tokens.length);\n      \n          for (var topic = 0; topic < props.numTopics; topic++) {\n            if (d.topicCounts[topic] >= tokenCutoff) {\n              documentTopics.push(topic);\n              topicProbabilities[topic]++; // Count the number of docs with this topic\n            }\n          }\n      \n          // Look at all pairs of topics that occur in the document.\n          for (var i = 0; i < documentTopics.length - 1; i++) {\n            for (var j = i + 1; j < documentTopics.length; j++) {\n              correlationMatrix[ documentTopics[i] ][ documentTopics[j] ]++;\n              correlationMatrix[ documentTopics[j] ][ documentTopics[i] ]++;\n            }\n          }\n        });\n        for (var t1 = 0; t1 < props.numTopics - 1; t1++) {\n          for (var t2 = t1 + 1; t2 < props.numTopics; t2++) {\n            correlationMatrix[t1][t2] = Math.log((props.documents.length * correlationMatrix[t1][t2]) /\n                                                 (topicProbabilities[t1] * topicProbabilities[t2]));\n            correlationMatrix[t2][t1] = Math.log((props.documents.length * correlationMatrix[t2][t1]) /\n                                                 (topicProbabilities[t1] * topicProbabilities[t2]));\n          }\n        }\n      \n        return correlationMatrix;\n      }\n\n    getCorrelationGraph(correlationMatrix, cutoff) {\n        var graph = {\"nodes\": [], \"links\": []};\n        for (var topic = 0; topic < props.numTopics; topic++) {\n          graph.nodes.push({\"name\": topic, \"group\": 1, \"words\": props.topNWords(props.topicWordCounts[topic], 3)});\n        }\n        for (var t1 = 0; t1 < props.numTopics; t1++) {\n          for (var t2 = 0; t2 < props.numTopics; t2++) {\n            if (t1 !== t2 && correlationMatrix[t1][t2] > cutoff) {\n              graph.links.push({\"source\": t1, \"target\": t2, \"value\": correlationMatrix[t1][t2]});\n            }\n          }\n        }\n        return graph;\n      }\n\n    componentDidMount() {\n        // Used in plotMatrix\n        var vis = d3.select(\"#corr-page\")\n        .append(\"svg\")\n        .attr(\"width\", w)\n        .attr(\"height\", h);\n\n        // Used by vis\n        d3.select(\"#corr-tab\").on(\"click\", function() {\n            d3.selectAll(\".page\").style(\"display\", \"none\");\n            d3.selectAll(\"ul li\").attr(\"class\", \"\");\n            d3.select(\"#corr-page\").style(\"display\", \"block\");\n            d3.select(\"#corr-tab\").attr(\"class\", \"selected\");\n        });\n    }\n\n    static getDerivedStateFromProps(props, state) {\n        \n    }\n\n    render() {\n      <div id=\"corr-page\" className=\"page\">\n        <div className=\"help\">Topics that occur together more than expected are blue, topics that occur together less than expected are red.</div>\n      </div>\n    }\n}\n\nexport default Correlation;"]},"metadata":{},"sourceType":"module"}